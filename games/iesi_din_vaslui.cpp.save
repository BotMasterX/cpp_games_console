#include <bits/stdc++.h>
#include <stdlib.h>
#include <time.h>
#include <conio.h>
#include <stdio.h>
using namespace std;

char mat[10][10];
int line[] = {-1, 0, 1, 0};
int col[] = {0, 1, 0, -1};
int lee_mat[12][22];
int total;
int level = 1;

bool obstacole[10][10];
queue <pair <int,int> > q;


void stergere()
{
  for (int i = 1; i <= 10; i++)
    for (int j = 1; j <= 10; j++)
      if(mat[i][j] != 'O' && mat[i][j] != 'V')
        mat[i][j] = ' ';
}
int lee(int i,int j, int n, int m)
{
  q.push(make_pair(i,j));
  lee_mat[i][j] = 1;
  while(!q.empty())
  {
    int line1 = q.front().first;
    int col1 = q.front().second;
    q.pop();
    for (int k = 0; k < 4; k++)
    {
        int i2 = line1 + line[k];
        int j2 = col1 + col[k];
        if(i2 >= 1 && i2 <= 10 && j2 >= 1 && j2 <= 10 && lee_mat[i2][j2] == 0)
        {
          lee_mat[i2][j2] = lee_mat[line1][col1] + 1;
          q.push(make_pair(i2,j2));
        }
    }
  }
  return lee_mat[n][m];
}

void put(int i, int j, int m, int n)
{
  mat[i][j] = 'O';
  mat[m][n] = 'X';
}

void initializare()
{
  for (int i = 1; i <= 10; i++)
    for (int j = 1; j <= 10; j++)
      mat[i][j] = ' ';

  for (int i = 1; i <= 10; i++)
    for (int j = 1; j <= 10; j++)
      lee_mat[i][j] = 0;

  for (int i = 0; i < 12; i++)
    lee_mat[i][0] = lee_mat[i][11] = lee_mat[0][i] = lee_mat[11][i] = -1;

  while(!q.empty())
    q.pop();

  for (int i = 1; i <= 10; i++)
    for (int j = 1; j <= 10; j++)
      obstacole[i][j] = false;
}
void desen()
{
cout << "LEVEL " << level << endl;
  cout << endl;
  int linie = 1;
  int coloana = 1;
  while(linie <= 10)
  {
    for (int i = 1; i <= 43; i++)
      cout << "-";
    cout << endl;
    for(int i = 1; i <= 10; i++)
      cout << " | " << mat[linie][coloana++];
    cout << " | " << endl;
    linie++;
    coloana = 1;
  }
  for (int i = 1; i <= 43; i++)
    cout << "-";
  cout << endl;

}

int main()
{
    system("Color 3");
    bool vreau = false;
    string vreaudif;
    cout << "DO YOU WANT OBSTACLES? WRITE YES!!!" << endl << endl;
    cin >> vreaudif;
    for (int i = 0; i < vreaudif.size(); i++)
        if(isalpha(vreaudif[i]))
            if(islower(vreaudif[i]))
                vreaudif[i] = char(vreaudif[i] - 32);
    if(vreaudif == "YES")
      vreau = true;
    int nr_obstacole = 0;
    if(vreau == true)
      while(1)
      {
        cout << endl << "HOW MANY?" << endl;
        cin >> nr_obstacole;
        if(nr_obstacole > 50)
          cout << endl << "TO MANY" << endl;
        else
          break;
      }
    srand(time(NULL));
    do
    {
        cout << "PRESS ENTER!!!" << endl;
    }while(cin.get() != '\n');

    system("cls");
    int generata_linie;
    int generata_coloana;
    int destinatie_i;
    int destinatie_j;

    while(level <= 100){

      while(1)
      {
        srand(time(NULL));

        while(1){
          generata_linie = rand() % 10 + 1;
          generata_coloana = rand() % 10 + 1;
          destinatie_i = rand() % 10 + 1;
          destinatie_j = rand() % 10 + 1;
          if(generata_linie == destinatie_i && generata_coloana == destinatie_j)
            continue;
          else
            break;
        }
        int n = 0;
        initializare();

          while(n < nr_obstacole){
              int obstacol_i, obstacol_j;
              while(1)
              {
                obstacol_i = rand() % 10 + 1;
                obstacol_j = rand() % 10 + 1;
                if(obstacole[obstacol_i][obstacol_j] == false && destinatie_i != obstacol_i && destinatie_j != obstacol_j && generata_linie != obstacol_i && generata_coloana != obstacol_j)
                {
                  mat[obstacol_i][obstacol_j] = 'V';
                  obstacole[obstacol_i][obstacol_j] = true;
                  lee_mat[obstacol_i][obstacol_j] = -1;
                  break;
                }
              }
              n++;
          }

        pune(generata_linie,generata_coloana, destinatie_i, destinatie_j);
        total = lee(generata_linie,generata_coloana,destinatie_i,destinatie_j) - 1;
        if(total > 0)
          break;
      }

      desen();
      int pasi = 0;
      int i_initial = destinatie_i;
      int j_initial = destinatie_j;
      bool dead = true;

      while(1 && pasi < total)
      {
          char c;
          while(1)
          {
            cout << endl << "up = w , down = s , left = a , right = d (FARA CAPS) " << endl;
            c = getche();

            if(c == 'w' && i_initial != 1 && mat[i_initial - 1][j_initial] == 'V'){
              system("cls");
              cout << "TE-AU LUAT VIOLATORII MAAAAA";
              return 0;
            }
            else if(c == 's' && i_initial != 10 && mat[i_initial + 1][j_initial] == 'V'){
              system("cls");
              cout << "TE-AU LUAT VIOLATORII MAAAAA";
              return 0;
            }
            else if(c == 'a' && j_initial != 1 && mat[i_initial][j_initial - 1] == 'V'){
              system("cls");
              cout << "TE-AU LUAT VIOLATORII MAAAAA";
              return 0;
            }
            else if(c == 'd' && j_initial != 10 && mat[i_initial][j_initial + 1] == 'V'){
              system("cls");
              cout << "TE-AU LUAT VIOLATORII MAAAAA";
              return 0;
            }


            if(c == 'w' && i_initial != 1){
              stergere();
              mat[i_initial - 1][j_initial] = 'X';
              i_initial--;
              break;
            }
            else if(c == 's' && i_initial != 10){
              stergere();
              mat[i_initial + 1][j_initial] = 'X';
              i_initial++;
              break;
            }
            else if(c == 'a' && j_initial != 1){
              stergere();
              mat[i_initial][j_initial - 1] = 'X';
              j_initial--;
              break;
            }
            else if(c == 'd' && j_initial != 10){
              stergere();
              mat[i_initial][j_initial + 1] = 'X';
              j_initial++;
              break;
            }
            else
              cout << endl << "INVALIDE ACCES!" << endl;
          }
          if(i_initial == generata_linie && j_initial == generata_coloana){
            dead = false;
            break;
          }
          system("cls");

          desen();
          pasi++;
      }
      if(dead)
      {
        system("cls");
        cout << "YOU LOSE";
        cout << endl;
        cout << "MORE ATENTION!!!" << endl;
        do
        {
            cout << "PRESS ENTER!!" << endl;
        }while(cin.get() != '\n');
        return 0;
      }
      level++;
      system("cls");
    }
      cout << endl << "GOOD JOB" << endl;


}
